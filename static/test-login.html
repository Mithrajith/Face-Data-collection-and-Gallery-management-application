<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Login - Admin Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>Admin Management Test</h3>
                    </div>
                    <div class="card-body">
                        <div id="loginStatus" class="alert alert-info">
                            <strong>Login Status:</strong> Not logged in
                        </div>
                        
                        <div id="loginSection">
                            <h5>Login</h5>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label>Username:</label>
                                    <input type="text" id="username" class="form-control" value="superadmin">
                                </div>
                                <div class="col-md-6">
                                    <label>Password:</label>
                                    <input type="password" id="password" class="form-control" value="admin123">
                                </div>
                            </div>
                            <button onclick="testLogin()" class="btn btn-primary">Test Login</button>
                        </div>
                        
                        <div id="adminSection" style="display: none;">
                            <h5>Admin Management</h5>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <button onclick="testAdminList()" class="btn btn-success">Test Admin List</button>
                                </div>
                                <div class="col-md-6">
                                    <button onclick="localStorage.removeItem('userRole'); location.reload()" class="btn btn-danger">Logout</button>
                                </div>
                            </div>
                            <div id="adminResults"></div>
                        </div>
                        
                        <div class="mt-3">
                            <h5>Instructions:</h5>
                            <ol>
                                <li>Click "Test Login" to login as superadmin</li>
                                <li>Click "Test Admin List" to verify admin API works</li>
                                <li>Open the main app at <a href="/static/index.html">/static/index.html</a></li>
                                <li>Go to Admin section and check if admin management is visible</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    localStorage.setItem('userRole', data.role);
                    document.getElementById('loginStatus').innerHTML = 
                        `<strong>Login Status:</strong> Logged in as ${data.role}`;
                    document.getElementById('loginStatus').className = 'alert alert-success';
                    document.getElementById('loginSection').style.display = 'none';
                    document.getElementById('adminSection').style.display = 'block';
                } else {
                    document.getElementById('loginStatus').innerHTML = 
                        `<strong>Login Failed:</strong> ${data.message}`;
                    document.getElementById('loginStatus').className = 'alert alert-danger';
                }
            } catch (error) {
                document.getElementById('loginStatus').innerHTML = 
                    `<strong>Error:</strong> ${error.message}`;
                document.getElementById('loginStatus').className = 'alert alert-danger';
            }
        }
        
        async function testAdminList() {
            try {
                const res = await fetch('/api/admins');
                const data = await res.json();
                
                document.getElementById('adminResults').innerHTML = `
                    <div class="alert alert-info">
                        <strong>Admin List Response:</strong><br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('adminResults').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        // Check if already logged in
        window.onload = function() {
            const userRole = localStorage.getItem('userRole');
            if (userRole) {
                document.getElementById('loginStatus').innerHTML = 
                    `<strong>Login Status:</strong> Already logged in as ${userRole}`;
                document.getElementById('loginStatus').className = 'alert alert-success';
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('adminSection').style.display = 'block';
            }
        };
    </script>
</body>
</html>
